<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cockpit Combat - Glassmorphism</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
        }

        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .checklist-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .checklist-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .checklist-item.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .checklist-item.completed {
            background: rgba(76, 175, 80, 0.3);
            border: 1px solid rgba(76, 175, 80, 0.5);
        }

        .item-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .item-emoji {
            font-size: 20px;
        }

        .item-text {
            font-weight: 600;
        }

        .item-time {
            font-size: 12px;
            opacity: 0.8;
        }

        .form-section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .form-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 15px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 14px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .form-input::placeholder, .form-textarea::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .form-select {
            cursor: pointer;
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .btn-primary {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }

        .btn-primary:hover {
            background: white;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
        }

        .status-indicator.completed {
            background: #4CAF50;
        }

        .connection-status {
            text-align: center;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 12px;
        }

        .connection-online {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid rgba(76, 175, 80, 0.5);
        }

        .connection-offline {
            background: rgba(255, 152, 0, 0.2);
            border: 1px solid rgba(255, 152, 0, 0.5);
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Status de connexion -->
        <div id="connectionStatus" class="connection-status connection-offline">
            üîÑ Connexion √† Airtable...
        </div>

        <!-- Header -->
        <div class="glass header">
            <h1>‚úÖ CHECKLIST QUOTIDIENNE</h1>
        </div>

        <!-- Checklist principale -->
        <div class="glass" id="mainChecklist">
            <div class="checklist-item" data-section="mental">
                <div class="item-content">
                    <span class="item-emoji">üß†</span>
                    <div>
                        <div class="item-text">MENTAL & PHYSIOLOGIE</div>
                        <div class="item-time">07:00 - 08:30</div>
                    </div>
                </div>
                <div class="status-indicator" id="mental-status"></div>
            </div>

            <div class="checklist-item" data-section="cardio">
                <div class="item-content">
                    <span class="item-emoji">üèÉ</span>
                    <div>
                        <div class="item-text">CARDIO & POIDS</div>
                        <div class="item-time">08:30 - 13:00</div>
                    </div>
                </div>
                <div class="status-indicator" id="cardio-status"></div>
            </div>

            <div class="checklist-item" data-section="muscu">
                <div class="item-content">
                    <span class="item-emoji">üí™</span>
                    <div>
                        <div class="item-text">MUSCU & D√âPASSEMENT</div>
                        <div class="item-time">13:00 - 20:00</div>
                    </div>
                </div>
                <div class="status-indicator" id="muscu-status"></div>
            </div>

            <div class="checklist-item" data-section="bilan">
                <div class="item-content">
                    <span class="item-emoji">üìù</span>
                    <div>
                        <div class="item-text">BILAN JOURNALIER</div>
                        <div class="item-time">20:00 - 07:00</div>
                    </div>
                </div>
                <div class="status-indicator" id="bilan-status"></div>
            </div>

            <button class="btn btn-secondary" onclick="showWeeklyReview()">
                üìä BILAN HEBDOMADAIRE
            </button>
        </div>

        <!-- Section Mental & Physiologie -->
        <div class="glass form-section" id="mental-section">
            <h2>üß† MENTAL & PHYSIOLOGIE</h2>
            
            <div class="form-group">
                <label class="form-label">üß† Ce matin, t'as la t√™te comment ?</label>
                <textarea class="form-textarea" id="mental-mood" placeholder="D√©cris ton √©tat mental..."></textarea>
            </div>

            <div class="form-group">
                <label class="form-label">üò¥ Heures de sommeil</label>
                <input type="number" class="form-input" id="sleep-hours" min="0" max="24" step="0.5">
            </div>

            <div class="form-group">
                <label class="form-label">üò¥ Qualit√© du sommeil (1-10)</label>
                <select class="form-select" id="sleep-quality">
                    <option value="">S√©lectionner</option>
                    <option value="1">1 - Tr√®s mauvais</option>
                    <option value="2">2 - Mauvais</option>
                    <option value="3">3 - M√©diocre</option>
                    <option value="4">4 - Passable</option>
                    <option value="5">5 - Moyen</option>
                    <option value="6">6 - Correct</option>
                    <option value="7">7 - Bon</option>
                    <option value="8">8 - Tr√®s bon</option>
                    <option value="9">9 - Excellent</option>
                    <option value="10">10 - Parfait</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">üîã R√©cup√©ration nerveuse (1-10)</label>
                <select class="form-select" id="recovery">
                    <option value="">S√©lectionner</option>
                    <option value="1">1 - √âpuis√©</option>
                    <option value="2">2 - Tr√®s fatigu√©</option>
                    <option value="3">3 - Fatigu√©</option>
                    <option value="4">4 - Un peu fatigu√©</option>
                    <option value="5">5 - Normal</option>
                    <option value="6">6 - Repos√©</option>
                    <option value="7">7 - Bien repos√©</option>
                    <option value="8">8 - Tr√®s repos√©</option>
                    <option value="9">9 - En forme</option>
                    <option value="10">10 - Au top</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">üéØ Objectif #1 de ta journ√©e</label>
                <textarea class="form-textarea" id="daily-goal" placeholder="Quel est ton objectif principal aujourd'hui ?"></textarea>
            </div>

            <button class="btn btn-primary" onclick="validateSection('mental')">
                ‚úÖ VALIDER CHECK
            </button>
        </div>

        <!-- Section Cardio & Poids -->
        <div class="glass form-section" id="cardio-section">
            <h2>üèÉ CARDIO & POIDS</h2>
            
            <div class="form-group">
                <label class="form-label">üèÉ T'as couru ce matin ?</label>
                <select class="form-select" id="cardio-done">
                    <option value="">S√©lectionner</option>
                    <option value="oui">Oui</option>
                    <option value="non">Non</option>
                </select>
            </div>

            <div class="form-group" id="cardio-details" style="display: none;">
                <label class="form-label">üìè Combien de km ?</label>
                <input type="number" class="form-input" id="cardio-distance" step="0.1" min="0">
            </div>

            <div class="form-group" id="cardio-time" style="display: none;">
                <label class="form-label">‚è±Ô∏è Temps (minutes)</label>
                <input type="number" class="form-input" id="cardio-duration" min="0">
            </div>

            <div class="form-group" id="cardio-rpe" style="display: none;">
                <label class="form-label">üí™ RPE (1-10)</label>
                <select class="form-select" id="cardio-intensity">
                    <option value="">S√©lectionner</option>
                    <option value="1">1 - Tr√®s facile</option>
                    <option value="2">2 - Facile</option>
                    <option value="3">3 - Mod√©r√©</option>
                    <option value="4">4 - Un peu dur</option>
                    <option value="5">5 - Dur</option>
                    <option value="6">6 - Dur+</option>
                    <option value="7">7 - Tr√®s dur</option>
                    <option value="8">8 - Tr√®s dur+</option>
                    <option value="9">9 - Extr√™me</option>
                    <option value="10">10 - Maximum</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">‚öñÔ∏è Poids (kg)</label>
                <input type="number" class="form-input" id="weight" step="0.1" min="0">
            </div>

            <button class="btn btn-primary" onclick="validateSection('cardio')">
                ‚úÖ VALIDER CHECK
            </button>
        </div>

        <!-- Section Muscu & D√©passement -->
        <div class="glass form-section" id="muscu-section">
            <h2>üí™ MUSCU & D√âPASSEMENT</h2>
            
            <div class="form-group">
                <label class="form-label">üí™ Muscu faite ?</label>
                <select class="form-select" id="muscu-done">
                    <option value="">S√©lectionner</option>
                    <option value="oui">Oui</option>
                    <option value="non">Non</option>
                </select>
            </div>

            <div class="form-group" id="muscu-details" style="display: none;">
                <label class="form-label">‚è±Ô∏è Dur√©e (min)</label>
                <input type="number" class="form-input" id="muscu-duration" min="0">
            </div>

            <div class="form-group" id="muscu-quality" style="display: none;">
                <label class="form-label">üî• Qualit√©</label>
                <select class="form-select" id="muscu-quality-rating">
                    <option value="">S√©lectionner</option>
                    <option value="mauvaise">Mauvaise</option>
                    <option value="moyenne">Moyenne</option>
                    <option value="bonne">Bonne</option>
                    <option value="excellente">Excellente</option>
                </select>
            </div>

            <div class="form-group" id="muscu-rpe" style="display: none;">
                <label class="form-label">üí™ RPE (1-10)</label>
                <select class="form-select" id="muscu-intensity">
                    <option value="">S√©lectionner</option>
                    <option value="1">1 - Tr√®s facile</option>
                    <option value="2">2 - Facile</option>
                    <option value="3">3 - Mod√©r√©</option>
                    <option value="4">4 - Un peu dur</option>
                    <option value="5">5 - Dur</option>
                    <option value="6">6 - Dur+</option>
                    <option value="7">7 - Tr√®s dur</option>
                    <option value="8">8 - Tr√®s dur+</option>
                    <option value="9">9 - Extr√™me</option>
                    <option value="10">10 - Maximum</option>
                </select>
            </div>

            <div class="form-group" id="muscu-notes" style="display: none;">
                <label class="form-label">üöÄ Action de d√©passement</label>
                <textarea class="form-textarea" id="muscu-breakthrough" placeholder="Qu'as-tu fait pour te d√©passer aujourd'hui ?"></textarea>
            </div>

            <button class="btn btn-primary" onclick="validateSection('muscu')">
                ‚úÖ VALIDER CHECK
            </button>
        </div>

        <!-- Section Bilan Journalier -->
        <div class="glass form-section" id="bilan-section">
            <h2>üìù BILAN JOURNALIER</h2>
            
            <div class="form-group">
                <label class="form-label">üìù Notes de la journ√©e</label>
                <textarea class="form-textarea" id="daily-notes" placeholder="R√©sum√© de ta journ√©e, points positifs, axes d'am√©lioration..."></textarea>
            </div>

            <div class="form-group">
                <label class="form-label">üçé Nutrition OK ?</label>
                <select class="form-select" id="nutrition">
                    <option value="">S√©lectionner</option>
                    <option value="oui">Oui</option>
                    <option value="non">Non</option>
                    <option value="moyen">Moyen</option>
                </select>
            </div>

            <button class="btn btn-primary" onclick="validateSection('bilan')">
                ‚úÖ VALIDER CHECK
            </button>
        </div>
    </div>

    <script>
        // Configuration Airtable
        const AIRTABLE_BASE_ID = 'appizAgKmYhccoFFB';
        const AIRTABLE_API_KEY = 'patk6JMmaYQvqeds6.9d4e1b0b93c5c08de4fbd33bbd6d6a79e3a05d0c4c9863e980b64fda9f82647e';
        const AIRTABLE_CHECKS_TABLE = 'Checks';
        const AIRTABLE_REVIEWS_TABLE = 'Weekly Reviews';

        // √âtat de l'application
        let currentSection = null;
        let completedSections = new Set();
        let isOnline = false;

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            testConnection();
            loadTodayData();
            setupEventListeners();
        });

        // Test de connexion Airtable
        async function testConnection() {
            try {
                const response = await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_CHECKS_TABLE}?maxRecords=1`, {
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_API_KEY}`
                    }
                });

                if (response.ok) {
                    isOnline = true;
                    updateConnectionStatus('online', '‚úÖ Connect√© √† Airtable');
                    console.log('‚úÖ Connexion Airtable r√©ussie');
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                isOnline = false;
                updateConnectionStatus('offline', 'üîÑ Mode offline - Donn√©es locales');
                console.error('‚ùå Erreur connexion Airtable:', error);
            }
        }

        // Mise √† jour du statut de connexion
        function updateConnectionStatus(status, message) {
            const statusEl = document.getElementById('connectionStatus');
            statusEl.textContent = message;
            statusEl.className = `connection-status connection-${status}`;
        }

        // Chargement des donn√©es du jour
        async function loadTodayData() {
            if (!isOnline) return;

            try {
                const today = new Date().toISOString().split('T')[0];
                const response = await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_CHECKS_TABLE}?filterByFormula={Date}='${today}'`, {
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_API_KEY}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.records.length > 0) {
                        populateFormData(data.records[0].fields);
                    }
                }
            } catch (error) {
                console.error('Erreur chargement donn√©es:', error);
            }
        }

        // Remplissage des formulaires avec les donn√©es existantes
        function populateFormData(fields) {
            // Impl√©mentation du remplissage des champs
            console.log('Donn√©es charg√©es:', fields);
        }

        // Configuration des event listeners
        function setupEventListeners() {
            // Gestion des clics sur les items de checklist
            document.querySelectorAll('.checklist-item').forEach(item => {
                item.addEventListener('click', function() {
                    const section = this.dataset.section;
                    if (section) {
                        showSection(section);
                    }
                });
            });

            // Gestion des champs conditionnels
            document.getElementById('cardio-done').addEventListener('change', function() {
                const details = document.querySelectorAll('#cardio-details, #cardio-time, #cardio-rpe');
                details.forEach(el => {
                    el.style.display = this.value === 'oui' ? 'block' : 'none';
                });
            });

            document.getElementById('muscu-done').addEventListener('change', function() {
                const details = document.querySelectorAll('#muscu-details, #muscu-quality, #muscu-rpe, #muscu-notes');
                details.forEach(el => {
                    el.style.display = this.value === 'oui' ? 'block' : 'none';
                });
            });
        }

        // Affichage d'une section
        function showSection(sectionName) {
            // Masquer toutes les sections
            document.querySelectorAll('.form-section').forEach(section => {
                section.classList.remove('active');
            });

            // Masquer la checklist principale
            document.getElementById('mainChecklist').style.display = 'none';

            // Afficher la section demand√©e
            const targetSection = document.getElementById(`${sectionName}-section`);
            if (targetSection) {
                targetSection.classList.add('active');
                currentSection = sectionName;
            }
        }

        // Retour √† la checklist principale
        function showMainChecklist() {
            document.querySelectorAll('.form-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById('mainChecklist').style.display = 'block';
            currentSection = null;
        }

        // Validation d'une section
        async function validateSection(sectionName) {
            const formData = collectFormData(sectionName);
            
            if (isOnline) {
                const success = await saveToAirtable(formData);
                if (success) {
                    markSectionCompleted(sectionName);
                    showMainChecklist();
                } else {
                    alert('Erreur lors de la sauvegarde. Donn√©es sauv√©es localement.');
                    markSectionCompleted(sectionName);
                    showMainChecklist();
                }
            } else {
                // Sauvegarde locale
                saveToLocalStorage(formData);
                markSectionCompleted(sectionName);
                showMainChecklist();
            }
        }

        // Collecte des donn√©es du formulaire
        function collectFormData(sectionName) {
            const data = {
                Date: new Date().toISOString().split('T')[0],
                Type: sectionName
            };

            if (sectionName === 'mental') {
                data['Mental Mood'] = document.getElementById('mental-mood').value;
                data['Sleep Hours'] = parseFloat(document.getElementById('sleep-hours').value) || null;
                data['Sleep Quality'] = parseInt(document.getElementById('sleep-quality').value) || null;
                data['Recovery'] = parseInt(document.getElementById('recovery').value) || null;
                data['Daily Goal'] = document.getElementById('daily-goal').value;
            } else if (sectionName === 'cardio') {
                data['Cardio Done'] = document.getElementById('cardio-done').value === 'oui';
                data['Cardio Distance'] = parseFloat(document.getElementById('cardio-distance').value) || null;
                data['Cardio Duration'] = parseInt(document.getElementById('cardio-duration').value) || null;
                data['Cardio Intensity'] = parseInt(document.getElementById('cardio-intensity').value) || null;
                data['Weight'] = parseFloat(document.getElementById('weight').value) || null;
            } else if (sectionName === 'muscu') {
                data['Muscle Training Done'] = document.getElementById('muscu-done').value === 'oui';
                data['Muscu Duration'] = parseInt(document.getElementById('muscu-duration').value) || null;
                data['Muscu Quality'] = document.getElementById('muscu-quality-rating').value;
                data['Muscu Intensity'] = parseInt(document.getElementById('muscu-intensity').value) || null;
                data['Muscu Notes'] = document.getElementById('muscu-breakthrough').value;
            } else if (sectionName === 'bilan') {
                data['Daily Notes'] = document.getElementById('daily-notes').value;
                data['Nutrition Ok'] = document.getElementById('nutrition').value === 'oui';
            }

            return data;
        }

        // Sauvegarde vers Airtable
        async function saveToAirtable(data) {
            try {
                const response = await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_CHECKS_TABLE}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        fields: data
                    })
                });

                if (response.ok) {
                    console.log('‚úÖ Donn√©es sauvegard√©es dans Airtable');
                    return true;
                } else {
                    console.error('‚ùå Erreur sauvegarde Airtable:', response.status);
                    return false;
                }
            } catch (error) {
                console.error('‚ùå Erreur r√©seau:', error);
                return false;
            }
        }

        // Sauvegarde locale
        function saveToLocalStorage(data) {
            const localData = JSON.parse(localStorage.getItem('cockpitData') || '[]');
            localData.push({
                ...data,
                timestamp: new Date().toISOString(),
                synced: false
            });
            localStorage.setItem('cockpitData', JSON.stringify(localData));
            console.log('üíæ Donn√©es sauvegard√©es localement');
        }

        // Marquer une section comme compl√©t√©e
        function markSectionCompleted(sectionName) {
            completedSections.add(sectionName);
            const statusIndicator = document.getElementById(`${sectionName}-status`);
            if (statusIndicator) {
                statusIndicator.classList.add('completed');
            }
            
            const item = document.querySelector(`[data-section="${sectionName}"]`);
            if (item) {
                item.classList.add('completed');
            }
        }

        // Affichage du bilan hebdomadaire
        function showWeeklyReview() {
            alert('Fonctionnalit√© bilan hebdomadaire √† venir !');
        }

        // Synchronisation des donn√©es locales (√† appeler quand la connexion revient)
        async function syncLocalData() {
            if (!isOnline) return;

            const localData = JSON.parse(localStorage.getItem('cockpitData') || '[]');
            const unsyncedData = localData.filter(item => !item.synced);

            for (const item of unsyncedData) {
                const success = await saveToAirtable(item);
                if (success) {
                    item.synced = true;
                }
            }

            localStorage.setItem('cockpitData', JSON.stringify(localData));
        }
    </script>
</body>
</html>
